<%= form_with(model: [:admin, @product], local: true, html: { multipart: true, class: "container mt-4" }) do |f| %>

  <% if @product.errors.any? %>
    <div class="alert alert-danger mb-4">
      <h5><%= pluralize(@product.errors.count, "error") %> prohibited this product from being saved:</h5>
      <ul>
        <% @product.errors.full_messages.each do |message| %>
          <li><%= message %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <!-- Product Name -->
  <div class="mb-3">
    <%= f.label :name, "Product Name", class: "form-label" %>
    <%= f.text_field :name, class: "form-control", required: true %>
  </div>

  <!-- Description -->
  <div class="mb-3">
    <%= f.label :description, "Description", class: "form-label" %>
    <%= f.text_area :description, value: (@product.description == "t" ? "" : @product.description), class: "form-control", rows: 4, required: true %>
  </div>

  <!-- Price & Stock Quantity -->
  <div class="row">
    <div class="col-md-6 mb-3">
      <%= f.label :price, "Price", class: "form-label" %>
      <%= f.number_field :price, value: @product.price, class: "form-control", step: 0.01, min: 0, required: true %>
    </div>

    <div class="col-md-6 mb-3">
      <%= f.label :stock_quantity, "Stock Quantity", class: "form-label" %>
      <%= f.number_field :stock_quantity, value: @product.stock_quantity, class: "form-control", min: 0, required: true %>
    </div>
  </div>

  <!-- Categories -->
  <div class="mb-3">
    <%= f.label :category_ids, "Categories", class: "form-label" do %>
      Categories <span class="text-danger">*</span>
    <% end %>
    <div class="border rounded p-3" style="max-height: 200px; overflow-y: auto;">
      <%= f.collection_check_boxes :category_ids, Category.all, :id, :name do |b| %>
        <div class="form-check">
          <%= b.check_box class: "form-check-input" %>
          <%= b.label class: "form-check-label" %>
        </div>
      <% end %>
    </div>
    <% if @product.errors[:categories].any? %>
      <div class="invalid-feedback d-block">
        <%= @product.errors[:categories].join(", ") %>
      </div>
    <% end %>
    <small class="form-text text-muted">Select one or more categories for this product</small>
  </div>


  <!-- Product Image -->
  <div class="mb-3">
    <%= f.label :image, "Product Image", class: "form-label" do %>
      Product Image <span class="text-danger">*</span>
    <% end %>
    <%= f.file_field :image, class: "form-control #{'is-invalid' if @product.errors[:image].any?}", accept: "image/*", required: !@product.persisted? %>
    <% if @product.errors[:image].any? %>
      <div class="invalid-feedback d-block">
        <%= @product.errors[:image].join(", ") %>
      </div>
    <% end %>
    <% if @product.persisted? %>
      <small class="form-text text-muted">Leave empty to keep current image. You can update it by selecting a new file.</small>
    <% else %>
      <small class="form-text text-muted"><strong>Required:</strong> Please click the button above to select an image file (JPG, PNG, etc.)</small>
    <% end %>

    <% if @product.image.attached? %>
      <div class="mt-2">
        <p>Current Image:</p>
        <%= image_tag url_for(@product.image),
                      class: "img-thumbnail",
                      style: "max-width: 150px; max-height: 150px; object-fit: cover;",
                      alt: @product.name %>
      </div>
    <% end %>
  </div>

  <!-- Active Checkbox -->
  <div class="form-check mb-4">
    <%= f.check_box :active, class: "form-check-input" %>
    <%= f.label :active, "Active", class: "form-check-label" %>
  </div>

  <!-- Submit Button -->
  <%= f.submit @product.persisted? ? "Update Product" : "Create Product", class: "btn btn-primary" %>

<% end %>
