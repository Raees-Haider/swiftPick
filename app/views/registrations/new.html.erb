  <%= image_tag "larg logo.png",
                class: "img-fluid mx-auto d-block mb-4",
                style: "height:80px; object-fit:cover;" %>

<div class="container mt-3 rounded border border-dark" style="max-width: 400px;">

  <h2 class="mb-4 text-center">Sign Up</h2>

  <% if flash[:alert] %>
    <div class="alert alert-danger alert-dismissible fade show" role="alert">
      <%= flash[:alert] %>
      <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
  <% end %>

  <% if @user.errors.any? %>
    <div class="alert alert-danger">
      <h6 class="alert-heading"><%= pluralize(@user.errors.count, "error") %> prohibited this account from being created:</h6>
      <ul class="mb-0">
        <% @user.errors.full_messages.each do |msg| %>
          <li><%= msg %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <%= form_with model: @user, url: signup_path, local: true, class: "needs-validation", novalidate: true do |f| %>
    <div class="mb-3">
      <%= f.label :name, "Full Name", class: "form-label" do %>
        Full Name <span class="text-danger">*</span>
      <% end %>
      <%= f.text_field :name, 
            class: "form-control #{'is-invalid' if @user.errors[:name].any?}", 
            required: true,
            minlength: 2,
            maxlength: 50,
            placeholder: "Enter your full name",
            value: @user.name %>
      <% if @user.errors[:name].any? %>
        <div class="invalid-feedback">
          <%= @user.errors[:name].first %>
        </div>
      <% end %>
    </div>

    <div class="mb-3">
      <%= f.label :email, "Email Address", class: "form-label" do %>
        Email Address <span class="text-danger">*</span>
      <% end %>
      <%= f.email_field :email, 
            class: "form-control #{'is-invalid' if @user.errors[:email].any?}", 
            required: true,
            placeholder: "Enter your email address",
            value: @user.email %>
      <% if @user.errors[:email].any? %>
        <div class="invalid-feedback">
          <%= @user.errors[:email].first %>
        </div>
      <% end %>
    </div>

    <div class="mb-3">
      <%= f.label :password, "Password", class: "form-label" do %>
        Password <span class="text-danger">*</span>
      <% end %>
      <%= f.password_field :password, 
            class: "form-control #{'is-invalid' if @user.errors[:password].any?}", 
            required: true,
            minlength: 6,
            placeholder: "Enter your password",
            id: "password" %>
      <% if @user.errors[:password].any? %>
        <div class="invalid-feedback">
          <%= @user.errors[:password].first %>
        </div>
      <% end %>
    </div>

    <div class="mb-3">
      <%= f.label :password_confirmation, "Confirm Password", class: "form-label" do %>
        Confirm Password <span class="text-danger">*</span>
      <% end %>
      <%= f.password_field :password_confirmation, 
            class: "form-control #{'is-invalid' if @user.errors[:password_confirmation].any?}", 
            required: true,
            placeholder: "Confirm your password",
            id: "password_confirmation" %>
      <% if @user.errors[:password_confirmation].any? %>
        <div class="invalid-feedback">
          <%= @user.errors[:password_confirmation].first %>
        </div>
      <% end %>
    </div>

    <%= f.submit "Sign Up", class: "btn btn-primary w-100 mb-3" %>
  <% end %>

  <div class="mt-3 text-center">
    <p class="mb-0">Already have an account? <%= link_to "Sign In", login_path %></p>
  </div>

  <script>
    // Password confirmation matching validation
    document.addEventListener('DOMContentLoaded', function() {
      const password = document.getElementById('password');
      const passwordConfirmation = document.getElementById('password_confirmation');
      const form = document.querySelector('.needs-validation');

      function validatePasswordMatch() {
        if (passwordConfirmation.value !== '') {
          if (password.value !== passwordConfirmation.value) {
            passwordConfirmation.setCustomValidity('Passwords do not match');
            passwordConfirmation.classList.add('is-invalid');
          } else {
            passwordConfirmation.setCustomValidity('');
            passwordConfirmation.classList.remove('is-invalid');
          }
        }
      }

      password.addEventListener('input', validatePasswordMatch);
      passwordConfirmation.addEventListener('input', validatePasswordMatch);

      form.addEventListener('submit', function(event) {
        if (!form.checkValidity()) {
          event.preventDefault();
          event.stopPropagation();
        }
        validatePasswordMatch();
        form.classList.add('was-validated');
      }, false);
    });
  </script>
</div>
